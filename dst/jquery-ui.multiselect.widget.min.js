!function(a){a.widget("ui.multiselect",{options:{hideSelect:!0,showCheckbox:!0,selectAll:!0,minItemFilter:5,maxItems:3,minWidth:0,defaultDisplayTitle:"No value selected",displayTextSG:"1 of ## value selected",displayTextPL:"@@ of ## values selected",trivialSeperator:", ",namespace:"ui-multiselect",isMultiple:void 0,isOpen:!1,event:{last:void 0},display:{$el:void 0,$title:void 0},wrap:{$el:void 0},list:{$wrap:void 0,$el:void 0,$options:void 0},options:[],selected:[]},_create:function(){var a=this,b=a.element;a.options.hideSelect!==!1&&b.hide(),a.options.isMultiple=void 0!==b.attr("multiple"),a._createMarkup()},_init:function(){var a=this;a._setListener(),a._refresh(),a._trigger("complete",null,{})},_refresh:function(){var a=this;a._getValues(),a.showSelected(),a.setTitle(),a._trigger("update")},_destroy:function(){var a=this,b=a.options;a._unsetListener(),b.display.$el.remove(),b.list.$wrap.remove(),a.element.show()},_createMarkup:function(){var a=this;a._createDisplay(),a._createList()},_createDisplay:function(){var b=this,c=b.options,d=c.namespace,e=c.display;e.$title=a('<span class="'+d+'--title"></span>'),e.$el=a('<button class="'+d+'--display"></button>').css("min-width",c.minWidth).html('<span class="'+d+'--icon"></span>').prepend(e.$title).insertAfter(this.element)},_getOptions:function(){var b=[];return a.each(this.element.find("option"),function(c,d){var e=a(d);b.push({title:e.text(),value:e.val(),"class":e.attr("class")})}),b},_getValues:function(){var a=this,b=a.element.val();return a.options.selected=b,b},getSelectedOptions:function(){var b=this.options,c=b.selected;return c?b.options.filter(b.isMultiple?function(b){return-1!==a.inArray(b.value,c)}:function(a){return a.value===String(c)}):null},_createList:function(){var b,c,d,e=this,f=e.options,g=f.namespace,h=f.list;b=f.options=e._getOptions(),c=h.$wrap=a('<div class="'+g+'--list-wrap"></div>'),d=h.$el=a('<ul class="'+g+'--list"></ul>').appendTo(c),a.each(b,function(c,e){var g,h=e.class,i=h?' class="'+h+'"':"";g=a('<li data-value="'+e.value+'"'+i+">"+e.title+"</li>").appendTo(d),f.isMultiple&&f.showCheckbox&&a('<input type="checkbox" value="" />').prependTo(g),b[c].$el=g}),"auto"!==f.minWidth&&c.css("min-width",f.minWidth),c.appendTo("body")},_setListener:function(){var a=this;a._setSelectListener(),a._setDisplayListener(),a._setListListener()},_setSelectListener:function(){var a=this;a.element.on("change.ui-ms",function(b){a._refresh(),a._trigger("change",b,{})})},_setListListener:function(){var b=this,c=b.options,d=c.event;c.list.$el.on("mousedown.ui-ms","li",function(e){var f=a(this).data("value");b._toggleValue(f),c.isMultiple===!1?b.close():d.last="multiselect",b._trigger("select",e,f)}),c.isMultiple&&c.showCheckbox&&c.list.$el.on("click.ui-ms","input",function(a){a.preventDefault()})},_setDisplayListener:function(){var a=this,b=a.options,c=b.event;b.display.$el.on({click:function(){"focus"!==c.last&&a.toggle(),c.last="click"},focus:function(){a.open(),c.last="focus"},blur:function(){"multiselect"===c.last?b.display.$el.focus():(a.close(),c.last="blur")}})},_toggleValue:function(b){var c=this,d=c.options,e=c.element;d.isMultiple?e.find('[value="'+b+'"]').prop("selected",-1===a.inArray(String(b),d.selected)):e.find('[value="'+b+'"]').prop("selected",!0),e.trigger("change")},toggle:function(){var a=this,b=a.options;b.isOpen===!1?a.open():a.close()},open:function(){var a=this,b=a.options,c=b.display.$el,d=c.offset(),e=c.outerHeight(),f=c.outerWidth();b.list.$wrap.css({top:d.top+e,left:d.left,minWidth:f>b.minWidth?f:b.minWidth}).show().addClass(b.namespace+"--open"),b.isOpen=!0,a._trigger("open",null,{})},close:function(){var a=this,b=a.options;b.list.$wrap.hide().removeClass(b.namespace+"--open"),b.isOpen=!1,a._trigger("close",null,{})},showSelected:function(){var b=this,c=b.options,d=b.getSelectedOptions(),e=a(),f=c.namespace+"--selected",g=c.list.$el.find("li");if(g.removeClass(f),c.isMultiple&&c.showCheckbox&&g.find(":checked").prop("checked",!1),d){for(var h=0,i=d.length;i>h;h++)e=e.add(d[h].$el);e.addClass(f).find("input").prop("checked",!0)}},getTrivialValue:function(){var a,b=this,c=b.options,d=b.getSelectedOptions(),e=c.defaultDisplayTitle;return null!==d&&(a=d.length,-1!==c.maxItems&&a>c.maxItems?(e=1===a?c.displayTextSG:c.displayTextPL.replace("@@",a),e=e.replace("##",c.options.length)):e=d.map(function(a){return a.title}).join(c.trivialSeperator)),e},setTitle:function(){var a=this;a.options.display.$title.text(a.getTrivialValue())}})}(jQuery);