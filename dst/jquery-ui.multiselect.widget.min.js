!function(a,b){a.widget("ui.multiselect",{options:{hideSelect:!0,showCheckbox:!0,bulkActions:!0,bulkToggle:!0,minItemFilter:5,maxItems:3,minWidth:0,defaultDisplayTitle:"No value selected",displayTextSG:"1 of ## value selected",displayTextPL:"@@ of ## values selected",trivialSeperator:", ",resetButtonText:"Filter reset",filterLabelText:"Filter",bulkAllText:"Select all",bulkNoneText:"De-Select all",namespace:"ui-multiselect",eventNamespace:"ui-ms",tabIndex:' tabindex="-1"',isDisabled:!1,isMultiple:!1,isOpen:!1,event:{last:b},display:{$el:b,$title:b},list:{$wrap:b,$el:b,$options:b},filter:{isVisible:!1,$el:b,$input:b,$reset:b},bulk:{$el:b,$all:b,$none:b,enabled:!1},options:{data:[],length:0},hasOptgroup:!1,optgroupDataKey:"jqms-group-id",optgroups:{data:[],length:0},selected:[]},_create:function(){var a=this,b=a.element,c=a.options;c.hideSelect!==!1&&b.hide(),a._propertyChecks(),b.addClass(c.namespace),a._createMarkup()},_init:function(){var a=this;a._setListener(),a.refresh(),a._trigger("complete",null,{})},_propertyChecks:function(){var a=this,c=a.element;a.options.isMultiple=c.attr("multiple")!==b,a.options.isDisabled=c.prop("disabled"),a.options.hasOptgroup=c.find("optgroup").length>0},refresh:function(){var a=this;a._propertyChecks(),a._getValues(),a.showSelected(),a.setTitle(),a._updateFilterDisplay(),a._trigger("refresh",null,{})},update:function(){var a=this;a._createListContent(),a.refresh(),a._trigger("update",null,{})},_destroy:function(){var a=this,b=a.options;b.display.$el.remove(),b.list.$wrap.remove(),a.element.removeClass(b.namespace),a.element.show()},_createMarkup:function(){var a=this,b=a.options;a._createDisplay(),a._createList(),a._createFilterMarkup(),b.isMultiple&&b.bulkActions===!0&&a._createBulkMarkup()},_createFilterMarkup:function(){var b,c=this,d=c.options,e=d.filter;b=e.$el=a('<div class="'+d.namespace+'--filter"><label>'+d.filterLabelText+"</label></div>"),e.$input=a('<input type="text" value=""'+d.tabIndex+" />").appendTo(b),e.$reset=a('<button type="button" title="'+d.resetButtonText+'"'+d.tabIndex+">"+d.resetButtonText+"</button>").appendTo(b),b.prependTo(d.list.$wrap),d.options.length<d.minItemFilter&&b.hide()},_createDisplay:function(){var b=this,c=b.options,d=c.namespace,e=c.display;e.$title=a('<span class="'+d+'--title"></span>'),e.$el=a('<button class="'+d+'--display"></button>').css("min-width",c.minWidth).html('<span class="'+d+'--icon"></span>').prepend(e.$title).insertAfter(this.element)},_createBulkMarkup:function(){var b,c=this,d=c.options,e=d.bulk;b=e.$el=a('<div class="'+d.namespace+'--bulk"></div>'),e.$all=a('<button title="'+d.bulkAllText+'" class="'+d.namespace+'--bulk-all"'+d.tabIndex+">"+d.bulkAllText+"</button>").appendTo(b),e.$none=a('<button title="'+d.bulkNoneText+'" class="'+d.namespace+'--bulk-none"'+d.tabIndex+">"+d.bulkNoneText+"</button>").appendTo(b),b.insertBefore(d.list.$el)},_getOptions:function(){var c=this,d=[],e=c.options.optgroupDataKey;a.each(c.element.find("option"),function(c,f){var g=a(f);d.push({groupID:g.data(e),source:g,disabled:g.is(":disabled"),title:g.text(),value:g.val(),"class":g.attr("class")}),g.attr("value")===b&&g.attr("value",g.val())}),c.options.options.data=d,c.options.options.length=d.length},_getOptgroups:function(){var c=this,d=c.options.optgroupDataKey,e=c.element.find("optgroup"),f=[];e.each(function(c,e){var g=c+1,h=a(e).data(d,g),i=h.find("option");f.push({id:g,source:h,$el:b,$list:b,selected:!1,disabled:h.is(":disabled"),label:h.attr("label"),"class":h.attr("class"),length:i.length}),i.data(d,g)}),c.options.optgroups.data=f,c.options.optgroups.length=e.length},_getValues:function(){var a=this,b=a.element.val();return a.options.selected=b,b},getSelectedOptions:function(){var b=this.options,c=b.selected;return c?b.isMultiple?b.options.data.filter(function(b){return-1!==a.inArray(b.value,c)}):b.options.data.filter(function(a){return a.value===String(c)}):null},_updateOptgroupStatus:function(){var a=this,b=a.options,c=b.optgroups.data;if(b.hasOptgroup&&b.isMultiple)for(var d=0,e=b.optgroups.length;e>d;d+=1){var f,g=c[d];f=a._getOptionsByGroupID(g.id).filter(function(a){return a.source.prop("selected")}),g.selected=g.length===f.length}},getSelected:function(b){var c=this,d=c.options,e=c.getSelectedOptions();if(b=b||!1,b&&d.hasOptgroup&&d.isMultiple&&e){var f=d.optgroups.data.filter(function(a){return a.selected});e=a.extend(e,f)}return e},_createList:function(){var b,c=this,d=c.options,e=d.namespace,f=d.list;b=f.$wrap=a('<div class="'+e+'--list-wrap"></div>'),f.$el=a('<ul class="'+e+'--list"></ul>').appendTo(b),c._createListContent(),d.isMultiple===!0&&b.addClass(e+"--is-multiple"),d.hasOptgroup===!0&&b.addClass(e+"--has-optgroup"),b.appendTo("body")},_getOptgroupByID:function(a){for(var b=this.options.optgroups,c=0;c<b.length;c++)if(b.data[c].id===a)return b.data[c];return!1},_getOptionsByGroupID:function(a){for(var b=this.options.options,c=[],d=0;d<b.length;d++)b.data[d].groupID===a&&c.push(b.data[d]);return c},_createOptgroupmarkup:function(b){var c,d,e=this,f=e.options,g=f.namespace,h=e._getOptgroupByID(b);return d=h.$el=a('<li class="'+g+'--optgroup-wrap"></li>').data(f.optgroupDataKey,b).data("disabled",h.disabled),c=h.$label=a("<label>"+h.label+"</label>").appendTo(d),h.$list=a('<ul class="'+g+'--outgroup-list"></ul>').appendTo(d),f.isMultiple&&f.showCheckbox&&a('<input type="checkbox" value="" />').prependTo(c),h.disabled===!0&&e.setItemDisabledProp(d,!0),h},_createListContent:function(){var b,c=this,d=c.options,e=d.hasOptgroup,f=d.namespace,g=d.list,h=g.$el,i={id:0};h.empty(),e===!0&&c._getOptgroups(),c._getOptions(),b=c._filterOptions(d.options.data),a.each(b,function(g,j){var k,l=j["class"];e===!0&&j.groupID!==i.id&&(i=c._createOptgroupmarkup(j.groupID),i.$el.appendTo(h)),k=a('<li class="'+f+'--option">'+j.title+"</li>").data({value:j.value,disabled:j.disabled}),k.appendTo(e===!0?i.$list:h),l&&k.addClass(l),d.isMultiple&&d.showCheckbox&&a('<input type="checkbox" value="" />').prependTo(k),j.disabled&&c.setItemDisabledProp(k,!0),b[g].$el=k}),"auto"!==d.minWidth&&d.list.$wrap.css("min-width",d.minWidth),c.showSelected()},_filterOptions:function(b){var c,d=this,e=d.options,f=e.list,g=f.$wrap,h=e.namespace+"--has-filter",i="",j=[];return e.filter.$input&&e.options.length>=e.minItemFilter&&(i=d.getFilterValue(),i=i.toLowerCase()),c=""!==i,c?a.each(b,function(a,b){var c=b.title.toLowerCase();i&&-1===c.indexOf(i)||j.push(b)}):j=b,g.toggleClass(h,c),d._trigger("filter",null,{value:i}),j},getFilterValue:function(){return this.options.filter.$input.val()},setItemDisabledProp:function(a,c){var d=this,e=d.options.namespace+"--disabled";c===b&&(c=!a.data("disabled")),c?a.addClass(e):a.removeClass(e),a.data("disabled",c).find('[type="checkbox"]').prop("disabled",c)},_reFocus:function(){var a=this.options;a.event.last="refocus",a.display.$el.focus()},_setListener:function(){var a=this,b=a.options;a._setSelectListener(),a._setDisplayListener(),a._setListListener(),a._setFilterListener(),b.isMultiple&&(b.bulkActions===!0&&a._setBulkListener(),b.hasOptgroup===!0&&a._setOptgroupListener(),b.showCheckbox&&a._setCheckboxListener()),a._setKeyboardListener()},_setCheckboxListener:function(){this.options.list.$el.on("click","input",function(a){return a.preventDefault(),!1})},_setSelectListener:function(){var a=this;a.element.on({change:function(b){a.refresh(),a._trigger("change",b,{})},DOMSubtreeModified:function(){a.update()}})},_setListListener:function(){var b=this,c=b.options,d=c.event;c.list.$el.on("mousedown.ui-ms","."+c.namespace+"--option",function(e){e.stopPropagation();var f=a(this),g=f.data("value"),h=f.data("disabled");return h?(c.display.$el.focus(),!1):(b._toggleValue(g),c.isMultiple===!1?b.close():d.last="refocus",void b._trigger("toggleOption",e,{value:g}))})},_setOptgroupListener:function(){var b=this,c=b.options;c.list.$el.on({"mousedown.ui-ms":function(){var d=a(this).data(c.optgroupDataKey),e=b._getOptgroupByID(d);e.selected=e.selected===!1,c.event.last="refocus",b._toggleValue(b._getOptionsByGroupID(d),e.selected)},"focus.ui-ms":function(a){a.preventDefault(),c.event.last="noblur",b._reFocus()}},"."+c.namespace+"--optgroup-wrap")},_setDisplayListener:function(){var a=this,b=a.options,c=b.event;b.display.$el.on({click:function(){"focus"!==c.last&&a.toggle(),c.last="click"},focus:function(){a.open(),c.last="focus"},blur:function(b){"refocus"===c.last?a._reFocus():"noblur"===c.last?b.preventDefault():(a.close(),c.last="blur")}})},_setFilterListener:function(){var a=this,b=a.options,c=b.filter,d=b.event;c.$reset.on("mousedown.ui-ms",function(){d.last="refocus",c.$input.val(""),a._createListContent()}),c.$input.on({mousedown:function(){d.last="noblur"},focus:function(){d.last="noblur"},blur:function(){a._reFocus()},keyup:function(){a._createListContent()}})},_setBulkListener:function(){var a=this,b=a.element,c=a.options.bulk;c.$all.on("mousedown.ui-ms",function(c){c.preventDefault(),a._bulkToggle(!0),a._reFocus(),b.trigger("change")}),c.$none.on("mousedown.ui-ms",function(c){c.preventDefault(),a._bulkToggle(!1),a._reFocus(),b.trigger("change")})},_setKeyboardListener:function(){var a=this,b=a.options,c=b.display.$el,d=b.filter;c.keydown(function(c){switch(c.keyCode){case 27:a.close();break;case 9:d.isVisible&&(c.preventDefault(),b.event="noblur",d.$input.focus())}})},_bulkToggle:function(b){var c=this,d=c._filterOptions(c.options.options.data);c.options.bulkToggle?a.each(d,function(a,c){c.source.prop("selected",b)}):c.element.find("option").prop("selected",b)},_toggleValue:function(c,d,e){var f,g=this,h=g.options,i=g.element;if(e=e||!0,Array.isArray(c))for(var j=0,k=c.length;k>j;j++)g._toggleValue(c[j].value,d,!1);h.isMultiple?(f=d!==b?d:-1===a.inArray(String(c),h.selected),i.find('[value="'+c+'"]').prop("selected",f),g._updateOptgroupStatus()):i.find('[value="'+c+'"]').prop("selected",!0),e===!0&&i.trigger("change")},toggle:function(){var a=this,b=a.options;b.isOpen===!1?a.open():a.close()},open:function(){var a=this,b=a.options,c=b.display.$el,d=c.offset(),e=c.outerHeight(),f=c.outerWidth();b.list.$wrap.css({top:d.top+e,left:d.left,minWidth:f>b.minWidth?f:b.minWidth}).show().addClass(b.namespace+"--open"),b.isOpen=!0,a._trigger("open",null,{})},close:function(){var a=this,b=a.options;b.list.$wrap.hide().removeClass(b.namespace+"--open"),b.isOpen=!1,a._trigger("close",null,{})},showSelected:function(){var b=this,c=b.options,d=b.getSelected(!0),e=a(),f=c.namespace+"--selected",g=c.list.$el.find("li");if(g.removeClass(f),c.isMultiple&&c.showCheckbox&&g.find(":checked").prop("checked",!1),d){for(var h=0,i=d.length;i>h;h++)e=e.add(d[h].$el);e.addClass(f).find("input").prop("checked",!0)}},_updateFilterDisplay:function(){var a=this,b=a.options,c=b.filter,d=c.$el;-1!==b.minItemFilter&&b.minItemFilter<=b.options.length?(d.show(),c.isVisible=!0):(d.hide(),c.isVisible=!1)},getTrivialValue:function(){var a,b=this,c=b.options,d=b.getSelectedOptions(),e=c.defaultDisplayTitle;return null!==d&&(a=d.length,-1!==c.maxItems&&a>c.maxItems?(e=1===a?c.displayTextSG:c.displayTextPL.replace("@@",a),e=e.replace("##",c.options.length)):0!==a&&(e=d.map(function(a){return a.title}).join(c.trivialSeperator))),e},setTitle:function(){var a=this;a.options.display.$title.text(a.getTrivialValue())}})}(jQuery);