!function(a){a.widget("ui.multiselect",{options:{hideSelect:!0,showCheckbox:!0,bulkActions:!0,bulkToggle:!0,minItemFilter:5,maxItems:3,minWidth:0,defaultDisplayTitle:"No value selected",displayTextSG:"1 of ## value selected",displayTextPL:"@@ of ## values selected",trivialSeperator:", ",resetButtonText:"Filter reset",filterLabelText:"Filter",bulkAllText:"Select all",bulkNoneText:"De-Select all",namespace:"ui-multiselect",tabIndex:' tabindex="-1"',isMultiple:void 0,isOpen:!1,event:{last:void 0},display:{$el:void 0,$title:void 0},wrap:{$el:void 0},list:{$wrap:void 0,$el:void 0,$options:void 0},filter:{$el:void 0,$input:void 0,$reset:void 0},bulk:{$el:void 0,$all:void 0,$none:void 0,enabled:!1},options:{data:[],length:0},selected:[]},_create:function(){var a=this,b=a.element,c=a.options;c.hideSelect!==!1&&b.hide(),a.options.isMultiple=void 0!==b.attr("multiple"),b.addClass(c.namespace),a._createMarkup()},_init:function(){var a=this;a._setListener(),a._refresh(),a._trigger("complete",null,{})},_refresh:function(){var a=this;a._getValues(),a.showSelected(),a.setTitle(),a._updateFilterDisplay(),a._trigger("refresh")},update:function(){var a=this;a._createListContent(),a._refresh(),a._trigger("update")},_destroy:function(){var a=this,b=a.options;b.display.$el.remove(),b.list.$wrap.remove(),a.element.removeClass(b.namespace),a.element.show()},_createMarkup:function(){var a=this;a._createDisplay(),a._createList(),a._createFilterMarkup(),a.options.bulkActions===!0&&a._createBulkMarkup()},_createFilterMarkup:function(){var b,c=this,d=c.options,e=d.filter;b=e.$el=a('<div class="'+d.namespace+'--filter"><label>'+d.filterLabelText+"</label></div>"),e.$input=a('<input type="text" value=""'+d.tabIndex+" />").appendTo(b),e.$reset=a('<button type="button" title="'+d.resetButtonText+'"'+d.tabIndex+">"+d.resetButtonText+"</button>").appendTo(b),b.prependTo(d.list.$wrap),d.options.length<d.minItemFilter&&b.hide()},_createDisplay:function(){var b=this,c=b.options,d=c.namespace,e=c.display;e.$title=a('<span class="'+d+'--title"></span>'),e.$el=a('<button class="'+d+'--display"></button>').css("min-width",c.minWidth).html('<span class="'+d+'--icon"></span>').prepend(e.$title).insertAfter(this.element)},_createBulkMarkup:function(){var b,c=this,d=c.options,e=d.bulk;b=e.$el=a('<div class="'+d.namespace+'--bulk"></div>'),e.$all=a('<button title="'+d.bulkAllText+'" class="'+d.namespace+'--bulk-all"'+d.tabIndex+">"+d.bulkAllText+"</button>").appendTo(b),e.$none=a('<button title="'+d.bulkNoneText+'" class="'+d.namespace+'--bulk-none"'+d.tabIndex+">"+d.bulkNoneText+"</button>").appendTo(b),b.insertBefore(d.list.$el)},_getOptions:function(){var b=this,c=[];a.each(b.element.find("option"),function(b,d){var e=a(d);c.push({source:a(this),disabled:e.is(":disabled"),title:e.text(),value:e.val(),"class":e.attr("class")}),void 0===e.attr("value")&&e.attr("value",e.val())}),b.options.options.data=c,b.options.options.length=c.length},_getValues:function(){var a=this,b=a.element.val();return a.options.selected=b,b},getSelectedOptions:function(){var b=this.options,c=b.selected;return c?b.options.data.filter(b.isMultiple?function(b){return-1!==a.inArray(b.value,c)}:function(a){return a.value===String(c)}):null},_createList:function(){var b,c=this,d=c.options,e=d.namespace,f=d.list;b=f.$wrap=a('<div class="'+e+'--list-wrap"></div>'),f.$el=a('<ul class="'+e+'--list"></ul>').appendTo(b),c._createListContent(),b.appendTo("body")},_createListContent:function(){var b,c=this,d=c.options,e=d.list,f=e.$el;f.empty(),c._getOptions(),b=c._filterOptions(d.options.data),a.each(b,function(e,g){var h,i=g.class;h=a("<li>"+g.title+"</li>").data({value:g.value,disabled:g.disabled}).appendTo(f),i&&h.addClass(i),d.isMultiple&&d.showCheckbox&&a('<input type="checkbox" value="" />').prependTo(h),g.disabled&&c.setItemDisabledProp(h,!0),b[e].$el=h}),"auto"!==d.minWidth&&d.list.$wrap.css("min-width",d.minWidth),c.showSelected()},_filterOptions:function(b){var c,d=this,e=d.options,f=e.list,g=f.$wrap,h=e.namespace+"--has-filter",i="",j=[];return e.filter.$input&&e.options.length>=e.minItemFilter&&(i=d.getFilterValue()),c=""!==i,c?a.each(b,function(a,b){i&&-1===b.title.indexOf(i)||j.push(b)}):j=b,g.toggleClass(h,c),j},getFilterValue:function(){return this.options.filter.$input.val()},setItemDisabledProp:function(a,b){var c=this,d=c.options.namespace+"--disabled";void 0===b&&(b=!a.data("disabled")),b?a.addClass(d):a.removeClass(d),a.data("disabled",b).find('[type="checkbox"]').prop("disabled",b)},_setListener:function(){var a=this;a._setSelectListener(),a._setDisplayListener(),a._setListListener(),a._setFilterListener(),a.options.bulkActions===!0&&a._setBulkListener()},_setSelectListener:function(){var a=this;a.element.on({change:function(b){a._refresh(),a._trigger("change",b,{})},DOMSubtreeModified:function(){a.update()}})},_setListListener:function(){var b=this,c=b.options,d=c.event;c.list.$el.on("mousedown.ui-ms","li",function(e){var f=a(this),g=f.data("value"),h=f.data("disabled");return h?(c.display.$el.focus(),!1):(b._toggleValue(g),c.isMultiple===!1?b.close():d.last="refocus",void b._trigger("select",e,g))}),c.isMultiple&&c.showCheckbox&&c.list.$el.one("click.ui-ms","input",function(a){a.preventDefault()})},_setDisplayListener:function(){var a=this,b=a.options,c=b.event;b.display.$el.on({click:function(){"focus"!==c.last&&a.toggle(),c.last="click"},focus:function(){a.open(),c.last="focus"},blur:function(b){"refocus"===c.last?a._reFocus():"noblur"===c.last?b.preventDefault():(a.close(),c.last="blur")}})},_reFocus:function(){var a=this.options;a.event.last="refocus",a.display.$el.focus()},_setFilterListener:function(){var a=this,b=a.options,c=b.filter,d=b.event;c.$reset.on("mousedown.ui-ms",function(){d.last="refocus",c.$input.val(""),a._createListContent()}),c.$input.on({mousedown:function(){d.last="noblur"},focus:function(){d.last="noblur"},blur:function(){a._reFocus()},keyup:function(){a._createListContent()}})},_setBulkListener:function(){var a=this,b=a.element,c=a.options.bulk;c.$all.on("mousedown.ui-ms",function(c){c.preventDefault(),a._bulkToggle(!0),a._reFocus(),b.trigger("change")}),c.$none.on("mousedown.ui-ms",function(c){c.preventDefault(),a._bulkToggle(!1),a._reFocus(),b.trigger("change")})},_bulkToggle:function(b){var c=this,d=c._filterOptions(c.options.options.data);c.options.bulkToggle?a.each(d,function(a,c){c.source.prop("selected",b)}):c.element.find("option").prop("selected",b)},_toggleValue:function(b){var c=this,d=c.options,e=c.element;d.isMultiple?e.find('[value="'+b+'"]').prop("selected",-1===a.inArray(String(b),d.selected)):e.find('[value="'+b+'"]').prop("selected",!0),e.trigger("change")},toggle:function(){var a=this,b=a.options;b.isOpen===!1?a.open():a.close()},open:function(){var a=this,b=a.options,c=b.display.$el,d=c.offset(),e=c.outerHeight(),f=c.outerWidth();b.list.$wrap.css({top:d.top+e,left:d.left,minWidth:f>b.minWidth?f:b.minWidth}).show().addClass(b.namespace+"--open"),b.isOpen=!0,a._trigger("open",null,{})},close:function(){var a=this,b=a.options;b.list.$wrap.hide().removeClass(b.namespace+"--open"),b.isOpen=!1,a._trigger("close",null,{})},showSelected:function(){var b=this,c=b.options,d=b.getSelectedOptions(),e=a(),f=c.namespace+"--selected",g=c.list.$el.find("li");if(g.removeClass(f),c.isMultiple&&c.showCheckbox&&g.find(":checked").prop("checked",!1),d){for(var h=0,i=d.length;i>h;h++)e=e.add(d[h].$el);e.addClass(f).find("input").prop("checked",!0)}},_updateFilterDisplay:function(){var a=this,b=a.options,c=b.filter.$el;-1!==b.minItemFilter&&b.minItemFilter<=b.options.length?c.show():c.hide()},getTrivialValue:function(){var a,b=this,c=b.options,d=b.getSelectedOptions(),e=c.defaultDisplayTitle;return null!==d&&(a=d.length,-1!==c.maxItems&&a>c.maxItems?(e=1===a?c.displayTextSG:c.displayTextPL.replace("@@",a),e=e.replace("##",c.options.length)):0!==a&&(e=d.map(function(a){return a.title}).join(c.trivialSeperator))),e},setTitle:function(){var a=this;a.options.display.$title.text(a.getTrivialValue())}})}(jQuery);